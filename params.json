{"name":"CRELAY","tagline":"Controlling relay cards for home automation with a Linux software","body":"# crelay\r\n#### Controlling different relay cards for home automation with a Linux software\r\n\r\n### About\r\nThis software is intended to run on Linux systems to control different relay cards in a unified way. It provides several interfaces for controlling the relays locally or remotely. The relays can be controlled by a human being via a device like smartphone or web browser, or directly by an intelligent device as used in the Internet of Things.  \r\nThe software was designed with the following requirements in mind:  \r\n\r\n - simple, intuitive usage and interface\r\n - as little dependencies as possible (libraries, external programs)\r\n - runs on different Linux distributions, different hardware platforms\r\n - lightweight, can run on simple devices\r\n - easily expandable (adding relay card types and user interfaces)\r\n\r\nNew relay cards support can be added by providing the cards driver code for detecting the card, reading and setting the relays.\r\nCurrently the following relay cards are supported:  \r\n\r\n- Conrad USB 4-channel relay card (http://www.conrad.de/ce/de/product/393905), see _Note 1_ below\r\n- Generic GPIO controlled relays, see _Note 2_ below  \r\n<br>\r\n\r\nThe following picture shows a high level view on the modular software architecture.  \r\n![Software architechture](https://raw.github.com/ondrej1024/crelay/master/screenshots/sw-architecture.png)\r\n<br><br>\r\n\r\n### Features\r\n- Command line mode and daemon mode with Web GUI\r\n- Automatic detection of communication port\r\n- Reading of current relay states\r\n- Setting of new relay states\r\n- Single pulse generation on relay contact\r\n- HTTP API for external clients (e.g. Smartphone/tablet apps)\r\n- Multiple relay card type support  \r\n<br>\r\n\r\n### Coming soon (to do)\r\n- ThingSpeak Talkback App client (https://thingspeak.com/docs/talkback)\r\n- Support for configuration file for custom parameters  \r\n<br>\r\n\r\n### Nice to have (wishlist)\r\n- Multiple card support\r\n- Access control for Web GUI and HTTP API\r\n- Programmable timers for relay actions  \r\n<br>\r\n\r\n### Screenshots\r\n\r\n#### Web GUI\r\n![Screenshot](https://raw.github.com/ondrej1024/crelay/master/screenshots/crelay-screenshot1.png)\r\n<br><br>\r\n![Screenshot](https://raw.github.com/ondrej1024/crelay/master/screenshots/crelay-screenshot2.png)\r\n<br><br>\r\n\r\n#### Command line interface\r\n\r\n    $ crelay \r\n    This is a utility to control the Conrad USB 4-relay card.\r\n    The program can be run in interactive (command line) mode or in daemon mode with\r\n    built-in web server.\r\n\r\n    Interactive mode:\r\n        crelay [<relay number>] [ON|OFF]\r\n\r\n           The state of any relay can be read or it can be changed to a new state.\r\n           If only the relay number is provided then the current state is returned,\r\n           otherwise the relays state is set to the new value provided as second parameter.\r\n           The USB communication port is auto detected. The first compatible device\r\n           found will be used.\r\n\r\n    Daemon mode:\r\n        crelay -d [<relay1_label> [<relay2_label> [<relay3_label> [<relay4_label>]]]] \r\n\r\n           In daemon mode the built-in web server will be started and the relays\r\n           can be completely controlled via a Web browser GUI or HTTP API.\r\n           Optionally a personal label for each relay can be supplied which will\r\n           be displayed next to the relay name on the web page.\r\n\r\n           To access the web interface point your Web browser to the following address:\r\n           http://<my-ip-address>:8000\r\n\r\n           To use the HTTP API send a POST or GET request from the client to this URL:\r\n           http://<my-ip-address>:8000/gpio                                                  \r\n<br>\r\n### HTTP API\r\nAn HTTP API is provided to access the server from external clients. This API is compatible with the PiRelay Android app. Therefore this app can be used on your Android phone to control <i>crelay</i> remotely.\r\n\r\n- API url  <pre><i>ip_address[:port]</i>/gpio</pre>\r\n- Method: <pre>POST or GET</pre>\r\n- Reading relay states<br>\r\n    Required Parameter: none\r\n- Setting relay state<br> \r\n    Required Parameter: <pre>pin=[1|2|3|4], status=[0|1|2] where 0=off 1=on 2=pulse</pre>\r\n- Response from server:\r\n<pre>\r\nRelay 1:[0|1]\r\nRelay 2:[0|1]\r\nRelay 3:[0|1]\r\nRelay 4:[0|1]\r\n</pre>\r\n<br>\r\n\r\n### Installation\r\n\r\n- Clone git repository:\r\n<pre>\r\n    git clone https://github.com/ondrej1024/crelay\r\n    cd crelay\r\n</pre>\r\n\r\n- Alternatively get latest source code version:\r\n<pre>\r\n    wget https://github.com/ondrej1024/crelay/archive/master.zip\r\n    unzip master.zip\r\n    cd crelay-master\r\n</pre>\r\n\r\n- Build and install:\r\n<pre>\r\n    cd src\r\n    make\r\n    sudo make install\r\n</pre>\r\n<br>\r\n\r\n### Adding new relay card drivers\r\nTODO  \r\n<br>\r\n\r\n##### _Note 1 (Conrad USB 4-channel relay card_):\r\nThe relay card software provided by Conrad is Windows only and uses a binary runtime DLL which implements the communication protocol between the host computer and the card. Thanks to a raspberrypi.org forum member, the communication protocol was discovered and made public. This made it possible to develop an open source driver for the Conrad card which can run on any Linux distribution with the cp210x kernel driver installed.\r\n\r\nIt needs the cp210x kernel driver for the Silabs CP2104 chip with GPIO support. The official in-kernel cp210x driver does currently not yet support GPIO operations. Therefore the Silabs driver from their home page needs to be used:\r\nhttp://www.silabs.com/products/mcu/pages/usbtouartbridgevcpdrivers.aspx\r\n\r\nUnfortunately the kernel internal interfaces are continuously changing and the Silabs drivers don't built just like that for any given kernel version. Therefore, for your convenience, the cp210x directory contains the patched driver sources and pre-built binary drivers for selected distros and kernel versions (currently only Raspberry Pi binaries are provided, contributions are welcome).  \r\n<br>\r\n\r\n##### _Note 2 (GPIO controlled relays)_:\r\nThe following GPIO pins are defined as factory default in relay_drv_gpio.c. Change these if you want to control different pins.\r\n<pre>\r\n #define RELAY1_GPIO_PIN 17 // GPIO 0\r\n #define RELAY2_GPIO_PIN 18 // GPIO 1\r\n #define RELAY3_GPIO_PIN 27 // GPIO 2 (RPi rev.2)\r\n #define RELAY4_GPIO_PIN 22 // GPIO 3\r\n #define RELAY5_GPIO_PIN 23 // GPIO 4\r\n #define RELAY6_GPIO_PIN 24 // GPIO 5\r\n #define RELAY7_GPIO_PIN 25 // GPIO 6\r\n #define RELAY8_GPIO_PIN  4 // GPIO 7\r\n</pre>\r\n\r\nIn order to be able to access the GPIO pins you need to run as superuser, therefore crelay needs to be executed with the <i>sudo</i> command on a multiuser system.\r\n","google":"UA-48477283-1","note":"Don't delete this file! It's used internally to help with page regeneration."}